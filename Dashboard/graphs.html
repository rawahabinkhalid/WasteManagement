<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Admin Panel - Graphical Reports</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
    <meta name="description" content="Huge selection of charts created with the React ChartJS Plugin">
    <meta name="msapplication-tap-highlight" content="no">
    <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-auth.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-database.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-storage.js"></script>
    <!--
    =========================================================
    * ArchitectUI HTML Theme Dashboard - v1.0.0
    =========================================================
    * Product Page: https://dashboardpack.com
    * Copyright 2019 DashboardPack (https://dashboardpack.com)
    * Licensed under MIT (https://github.com/DashboardPack/architectui-html-theme-free/blob/master/LICENSE)
    =========================================================
    * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
    -->
    <link href="./main.css" rel="stylesheet">
</head>

<body>
    <div class="app-container app-theme-white body-tabs-shadow fixed-sidebar fixed-header">
        <div class="app-header header-shadow">
            <div class="app-header__logo">
                <div class="logo-src"></div>
                <div class="header__pane ml-auto">
                    <div>
                        <button type="button" class="hamburger close-sidebar-btn hamburger--elastic" data-class="closed-sidebar">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="app-header__mobile-menu">
                <div>
                    <button type="button" class="hamburger hamburger--elastic mobile-toggle-nav">
                        <span class="hamburger-box">
                            <span class="hamburger-inner"></span>
                        </span>
                    </button>
                </div>
            </div>
            <div class="app-header__menu">
                <span>
                    <button type="button"
                        class="btn-icon btn-icon-only btn btn-primary btn-sm mobile-toggle-header-nav">
                        <span class="btn-icon-wrapper">
                            <i class="fa fa-ellipsis-v fa-w-6"></i>
                        </span>
                </button>
                </span>
            </div>
            <div class="app-header__content">
                <div class="app-header-right">
                    <div class="header-btn-lg pr-0">
                        <div class="widget-content p-0">
                            <div class="widget-content-wrapper">
                                <div class="widget-content-left">
                                    <div class="btn-group">
                                        <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="p-0 btn">
                                            <i class="fa fa-angle-down ml-2 opacity-8"></i>
                                        </a>
                                        <div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu dropdown-menu-right">
                                            <div tabindex="-1" class="dropdown-divider"></div>
                                            <button type="button" tabindex="0" class="dropdown-item">Logout</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="widget-content-left  ml-3 header-user-info">
                                    <div class="widget-heading">
                                        Admin
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="app-main">
            <div class="app-sidebar sidebar-shadow">
                <div class="scrollbar-sidebar">
                    <div class="app-sidebar__inner">
                        <ul class="vertical-nav-menu">
                            <li class="app-sidebar__heading">Dashboards</li>
                            <li>
                                <a href="dashboard.html">
                                    <i class="metismenu-icon pe-7s-rocket"></i> Dashboard
                                </a>
                            </li>
                            <li>
                                <a href="tickets.html">
                                    <i class="metismenu-icon pe-7s-diamond"></i> Tickets
                                </a>
                            </li>
                            <li>
                                <a href="report.html">
                                    <i class="metismenu-icon pe-7s-car"></i> Reports
                                </a>
                            </li>
                            <li>
                                <a href="duereport.html">
                                    <i class="metismenu-icon pe-7s-display2"></i> Due Assignment Report
                                </a>
                            </li>
                            <li>
                                <a href="graphs.html" class="mm-active">
                                    <i class="metismenu-icon pe-7s-mouse">
                                    </i>Graphical Reports
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="app-main__outer">
                <div class="app-main__inner">
                    <div class="app-page-title">
                        <div>
                            <p>Graphical Report</p>
                        </div>
                        <!-- <div class="page-title-wrapper">
                            <div class="page-title-heading">
                                <div class="form-row">
                                    <div class="col-lg-5">
                                        <div class="position-relative form-group">
                                            <select class="form-control">
                                                <option value="" disabled selected>District</option>
                                                <option value="">South</option>
                                                <option value="">East</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="position-relative form-group">
                                            <select class="form-control">
                                                <option value="" disabled selected>Zones</option>
                                                <option value="">1</option>
                                                <option value="">2</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-3">
                                        <div class="position-relative form-group">
                                            <select class="form-control">
                                                <option value="" disabled selected>UCs</option>
                                                <option value="">1</option>
                                                <option value="">2</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="page-title-actions">
                                <div class="row">
                                    <div class="col-lg-5">
                                        <input type="date" class="form-control" name="" id="">
                                    </div>
                                    <div class="col-lg-5">
                                        <input type="date" class="form-control" name="" id="">
                                    </div>
                                    <div class="col-lg-2">
                                        <div class="d-inline-block dropdown">
                                            <button class="btn btn-primary" data-toggle="" data-target="">Search</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                    </div>
                    <!-- <ul class="body-tabs body-tabs-layout tabs-animated body-tabs-animated nav">
                        <li class="nav-item">
                            <a role="tab" class="nav-link active" id="tab-0" data-toggle="tab" href="#tab-content-0">
                                <span>Circular Charts</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tab-1" data-toggle="tab" href="#tab-content-1">
                                <span>Lines & Bars Charts</span>
                            </a>
                        </li>
                    </ul> -->
                    <div class="tab-content">
                        <div class="tab-pane tabs-animation fade show active" id="tab-content-0" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="main-card mb-3 card">
                                        <div class="card-body">
                                            <h5 class="card-title">Category Wise Complaint</h5>
                                            <canvas id="bar"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="main-card mb-3 card">
                                        <div class="card-body">
                                            <h5 class="card-title">Resolve Time Analysis</h5>
                                            <canvas id="pie"></canvas>
                                        </div>
                                    </div>
                                    <!-- <div class="main-card mb-3 card">
                                        <div class="card-body">
                                            <h5 class="card-title">Total Registered Complaint</h5>
                                            <p>Zone Wise (Complaint)</p>
                                            <canvas id="zonewise"></canvas>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="main-card mb-3 card">
                                        <div class="card-body">
                                            <h5 class="card-title">Total Registered Complaint</h5>
                                            <p>Zone Wise (Complaint)</p>
                                            <canvas id="zonewised" height="80px !important"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                    <div class="app-wrapper-footer">
                        <div class="app-footer">
                            <div class="app-footer__inner">
                                <div class="app-footer-left">
                                    <ul class="nav">
                                        <li class="nav-item">
                                            <a href="javascript:void(0);" class="nav-link">
                                            Copy Rights MATZ Solutions
                                        </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="./assets/scripts/main.js"></script>
        <script src="../vendor/jquery/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="./assets/scripts/myscript.js"></script>
        <script src="../js/firebase.js"></script>

        <script>
            var labels2 = ['Lyari', 'Saddar', 'Office-South', 'Jamshed', 'Gulshan'];
            var labels2Id = ['1', '2', '8', '3', '4'];
            var categories = ["Waste collection", "Washing and sprinkling demand", "Sweeping related complaint", "Staff related complaint", "Removal of waste from open plots", "Removal of open heaps", "Removal of de-silated  material", "Removal of dead animals", "Removal of construction and demolition waste", "Non-Availability of garbage bags", "Non subjective", "Littering during waste transportation", "Delayed DTD waste collection", "Container related complaint", "Clogging of road side open drains", "Other"];
            var count = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            // var countt = [0, 0, 0];
            var vcount = [0, 0, 0];
            var color = ["#7bce45", "#ffca43", "#ee2222", "#454545", "#88b9ff", "#800000", "#9A6324", "#808000", "#000075", "#f032e6", "#f58231", "#e6beff", "#fabebe", "#bfef45", "#ffd8b1", "#469990", "#911eb4"];
            var activeTotalRegistered = [0, 0, 0, 0, 0];
            var assignedTotalRegistered = [0, 0, 0, 0, 0];
            var invalidTotalRegistered = [0, 0, 0, 0, 0];
            var rejectedTotalRegistered = [0, 0, 0, 0, 0];
            var reopenTotalRegistered = [0, 0, 0, 0, 0];
            var resolvedTotalRegistered = [0, 0, 0, 0, 0];

            drawCategoryWiseComplaint();
            drawResolveTimeComplaint();
            totalRegisteredTimeComplaint();

            var database = firebase.database();
            var date = new Date();
            var currentMonth = parseInt(date.getMonth()) + 1;
            var today =
                date.getFullYear() + "/" + currentMonth + "/" + date.getDate();
            // console.log(userId)
            database.ref("users/").on("value", function(snapshot) {
                if (snapshot.exists()) {
                    var content = "";
                    // $('#list_complaint').html(content);
                    // var i = 1;
                    snapshot.forEach(function(data) {
                        // i++;
                        // var val = data.val();
                        var key = data.key;
                        // console.log(val2);
                        database.ref("users/" + key + "/").on("value", function(snapshot1) {
                            if (snapshot1.exists()) {
                                snapshot1.forEach(function(data1) {
                                    var val = data1.val();
                                    status = isset(val.status) ? val.status : "ACTIVE";
                                    // console.log(status);

                                    // console.log(val);
                                    if (
                                        categories.indexOf(val.CompainType) >= 0
                                    ) {
                                        // console.log(val.currentDate);
                                        count[
                                            categories.indexOf(val.CompainType)
                                        ]++;
                                    }

                                    if (val.resolving_duration >= '1' && val.resolving_duration <= '8') {
                                        vcount[0]++;
                                    } else if (val.resolving_duration >= '9' && val.resolving_duration <= '16') {
                                        vcount[1]++;
                                    } else if (val.resolving_duration >= '17' && val.resolving_duration <= '24') {
                                        vcount[2]++;
                                    }
                                    if (labels2Id.indexOf(val.zone_id) >= 0) {
                                        // console.log(status + ' | ' + val.zone_id + ' | ' + labels2Id.indexOf(val.zone_id));
                                        if (status == "ACTIVE")
                                            activeTotalRegistered[labels2Id.indexOf(val.zone_id)]++;
                                        else if (status == "ASSIGNED")
                                            assignedTotalRegistered[labels2Id.indexOf(val.zone_id)]++;
                                        else if (status == "RESOLVED")
                                            resolvedTotalRegistered[labels2Id.indexOf(val.zone_id)]++;
                                        else if (status == "REJECTED")
                                            rejectedTotalRegistered[labels2Id.indexOf(val.zone_id)]++;
                                        else if (status == "REOPEN")
                                            reopenTotalRegistered[labels2Id.indexOf(val.zone_id)]++;
                                        else if (status == "INVALID")
                                            invalidTotalRegistered[labels2Id.indexOf(val.zone_id)]++;

                                    }

                                });
                            }
                        });
                    });
                }
                drawCategoryWiseComplaint();
                drawResolveTimeComplaint();
                totalRegisteredTimeComplaint();
                // console.log(activeTotalRegistered);
                count = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                vcount = [0, 0, 0];
                activeTotalRegistered = [0, 0, 0, 0, 0];
                assignedTotalRegistered = [0, 0, 0, 0, 0];
                invalidTotalRegistered = [0, 0, 0, 0, 0];
                rejectedTotalRegistered = [0, 0, 0, 0, 0];
                reopenTotalRegistered = [0, 0, 0, 0, 0];
                resolvedTotalRegistered = [0, 0, 0, 0, 0];
            });

            function drawCategoryWiseComplaint() {
                var ctx = document.getElementById("bar");
                var myChart = new Chart(ctx, {
                    type: 'horizontalBar',
                    data: {
                        labels: categories,
                        datasets: [{
                            //                        label: "Categories Wise Complaint",
                            data: count,
                            backgroundColor: [
                                '#7bce45',
                                '#ffca43',
                                '#ee2222',
                                '#800000',
                                '#88b9ff',
                                '#9A6324',
                                '#808000',
                                '#000075',
                                '#f032e6',
                                '#f58231',
                                '#e6beff',
                                '#fabebe',
                                '#bfef45',
                                '#ffd8b1',
                                '#911eb4',
                                '#454545',

                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {

                        legend: {
                            display: false,
                            labels: {},
                            onClick: function() {
                                return false;
                            }
                        }
                    }
                });

            }


            function drawResolveTimeComplaint() {
                var countt = vcount;
                var name = ["1 Hour to 8 Hour", "9 Hour to 16 Hour", "17 Hour to 24 Hour"];

                var ctx = document.getElementById("pie");
                var myChart1 = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: name,
                        datasets: [{
                            label: 'Category wise',
                            data: countt,
                            backgroundColor: color,
                            borderWidth: 1,
                            labelFontSize: '16'
                        }]
                    },

                    options: {
                        legend: {
                            text: name,
                            hidden: true,

                        }
                    }
                });
            }

            function totalRegisteredTimeComplaint() {
                var ctx = document.getElementById("zonewised");
                var myChart = new Chart(document.getElementById("zonewised"), {
                    type: 'bar',
                    data: {
                        labels: labels2,
                        datasets: [{
                            "label": "ACTIVE",
                            "backgroundColor": "#ffca43",
                            "data": activeTotalRegistered
                        }, {
                            "label": "ASSIGNED",
                            "backgroundColor": "#88b9ff",
                            "data": assignedTotalRegistered
                        }, {
                            "label": "INVALID",
                            "backgroundColor": "#7bce45",
                            "data": invalidTotalRegistered
                        }, {
                            "label": "REJECTED",
                            "backgroundColor": "#ee2222",
                            "data": rejectedTotalRegistered
                        }, {
                            "label": "REOPEN",
                            "backgroundColor": "#800000",
                            "data": reopenTotalRegistered
                        }, {
                            "label": "RESOLVED",
                            "backgroundColor": "#454545",
                            "data": resolvedTotalRegistered
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                barThickness: 25,
                            }]
                        },
                        title: {
                            display: true,
                            text: 'Zone Wise (Complaint)'
                        },
                        legend: {
                            display: true,
                        }
                    }
                });
                // console.log(myChart.data.datasets);
            }

            function isset(ref) {
                return typeof ref !== "undefined";
            }
        </script>
</body>

</html>